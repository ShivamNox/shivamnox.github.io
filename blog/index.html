<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Blog | shivamnox</title>
<style>
body {
  font-family: system-ui, sans-serif;
  max-width: 800px;
  margin: auto;
  padding: 1rem;
  line-height: 1.6;
}
h1 { text-align: center; margin-bottom: 2rem; }
.post-card { border-bottom: 1px solid #ddd; padding-bottom: 1rem; margin-bottom: 1.5rem; }
.post-card img { width: 100%; border-radius: 8px; }
.post-card h2 { margin: .5rem 0; }
.meta { color: gray; font-size: 0.9em; margin-bottom: 0.5rem; }
.labels span {
  background: #eee;
  padding: 3px 8px;
  margin-right: 5px;
  border-radius: 5px;
  font-size: 0.8em;
}
button {
  display: block;
  margin: 1rem auto;
  padding: 10px 20px;
  cursor: pointer;
  border: none;
  background: black;
  color: white;
  border-radius: 5px;
}
</style>
</head>
<body>
<h1>My Blog</h1>
<div id="posts"></div>
<button id="load-more" style="display:none;">Load More</button>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
const POSTS_PER_PAGE = 10;
let allPosts = [], currentPage = 1;

async function init() {
  const res = await fetch('../posts/index.json');
  const files = await res.json();
  allPosts = files.reverse();
  renderPosts();
}

async function renderPosts() {
  const start = (currentPage - 1) * POSTS_PER_PAGE;
  const end = currentPage * POSTS_PER_PAGE;
  const slice = allPosts.slice(start, end);
  const container = document.getElementById('posts');

  for (const file of slice) {
    const html = await fetch(`../posts/${file}`).then(r => r.text());
    const meta = extractFrontmatter(html);
    const md = extractMarkdown(html);
    const excerpt = md.split('\n').slice(0, 3).join(' ');
    const el = document.createElement('div');
    el.className = 'post-card';
    el.innerHTML = `
      <img src="${meta.image}" alt="${meta.title}">
      <h2><a href="post.html?slug=${file.replace('.html','')}">${meta.title}</a></h2>
      <p class="meta">${meta.author} â€¢ ${formatDate(meta.date)}</p>
      <p>${excerpt}</p>
      <p class="labels">${meta.labels.split(',').map(l=>`<span>${l.trim()}</span>`).join(' ')}</p>`;
    container.appendChild(el);
  }

  const loadBtn = document.getElementById('load-more');
  if (end < allPosts.length) {
    loadBtn.style.display = 'block';
    loadBtn.onclick = () => { currentPage++; renderPosts(); };
  } else loadBtn.style.display = 'none';
}

function extractFrontmatter(txt) {
  const match = txt.match(/^---([\s\S]*?)---/);
  const fm = {};
  if (match) match[1].trim().split('\n').forEach(line=>{
    const [k, ...v] = line.split(':');
    fm[k.trim()] = v.join(':').trim();
  });
  return fm;
}

function extractMarkdown(txt) {
  const m = txt.match(/<script type="text\/markdown">([\s\S]*?)<\/script>/);
  return m ? m[1].trim() : '';
}

function formatDate(d) {
  return new Date(d).toLocaleDateString('en-US',{year:'numeric',month:'long',day:'numeric'});
}

init();
</script>
</body>
</html>
